var Travelsoft=Travelsoft||{};(function(a){"use strict";a.SITE_ADDRESS="https://vetliva.ru",a.REQUEST_URL=a.SITE_ADDRESS+"/travelsoft.pm",a.JS_URL=a.REQUEST_URL+"/assets/js",a.CSS_URL=a.REQUEST_URL+"/assets/css"})(Travelsoft);(function(a){"use strict";a.utils={callbacks:{},makeid:function(){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;5>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b},sendRequest:function(b,c,d){function f(){g||(delete a.utils.callbacks[h],console.warn("Query error "+j))}var g=!1,h="cb"+(Math.random()+"").slice(-6),j=a.REQUEST_URL+"/?",k=c,l;k.push("callback=Travelsoft.utils.callbacks."+h),k.push("method="+b),j+=k.join("&"),a.utils.callbacks[h]=function(m){g=!0,delete a.utils.callbacks[h],d(m)},l=document.createElement("script"),l.type="text/javascript",l.onload=f,l.onerror=f,l.src=j,document.body.appendChild(l)},screen:function(b){var c="";return"string"==typeof b&&(c=b.replace(/&/g,"&amp;"),c=b.replace(/</g,"&lt;"),c=b.replace(/"/g,"&quot;"),c=b.replace(/>/g,"&gt;"),c=b.replace(/'/g,"&#039;"),c=b.replace(/script/g,""),c=b.replace(/onclick/g,""),c=b.replace(/onchange/g,""),c=b.replace(/onkeydown/g,""),c=b.replace(/onkeypress/g,""),c=b.replace(/onmouseout/g,""),c=b.replace(/onmouseover/g,"")),c},HWatcher:{__prev:null,__id:null,__parent:null,watch:function(b){var c=this;c.unwatch(b),c.__id=setInterval(function(){c.__prev!==b.scrollHeight&&(c.__parent&&(c.__parent.style.height=b.scrollHeight+10+"px"),c.__prev=b.scrollHeight)},100)},unwatch:function(b){this.__id&&(clearInterval(this.__id),this.__id=null,this.__prev=null,b.style.height=0)}}}})(Travelsoft);(function(a){"use strict";function b(f){var g=d(c(f));return window.parent.document.body.appendChild(g),g}function c(f){return{styles:{position:"absolute",display:"none",top:f.top+6+"px",left:f.left+"px",width:f.width+"px",height:f.height+"px",border:"1px solid #ccc","box-sizing":"border-box","z-index":10,"padding-right":"1px"},attributes:{src:"about:blank",id:f.iframe_id,scrolling:f.scrolling?"yes":"no",className:"iframe-plugin"},iframeContent:``,iframeStylesheets:function(){return["<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\" integrity=\"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u\" crossorigin=\"anonymous\">","<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css\" integrity=\"sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp\" crossorigin=\"anonymous\">"].join("")+[a.CSS_URL+`/forms/${f.plugin_name}.min.css?`+1e5*Math.random()].map(function(g){return`<link rel="stylesheet" href="${g}">`}).join("")+`<style>${a.utils.screen(f.css)}</style>`}(),iframeScripts:function(){return[a.JS_URL+`/bundles/${f.plugin_name}.js`].map(function(g){return`<script type="text/javascript" src="${g}"></script>`}).join("")+`<script>Travelsoft.${f.plugin_name}.init(${JSON.stringify({iframe_id:f.iframe_id,data:f.data,without:f.without})})</script>`}()}}function d(f){var g=document.createElement("iframe");for(var h in f.styles)g.style[h]=f.styles[h];for(var j in f.attributes)g[j]=f.attributes[j];return g.onload=function(){g.contentDocument.write(a.frames.template.replace("{{stylesheets}}",f.iframeStylesheets).replace("{{content}}",f.iframeContent).replace("{{scripts}}",f.iframeScripts))},g}a.frames={template:`<!DOCTYPE html>
                        <html>
                            <head>
                                <title>travelsoft partner module</title>
                                <meta charset="UTF-8">
                                {{stylesheets}}
                            </head>
                            <body>
                                {{content}}
                                {{scripts}}
                            </body>
                        </html>`,render:{forms:{form:function(f){var g=d({styles:{width:"100%",border:"none"},attributes:{src:"about:blank",id:"search-forms",scrolling:"yes"},iframeContent:``,iframeStylesheets:function(){return["<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\" integrity=\"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u\" crossorigin=\"anonymous\">","<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css\" integrity=\"sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp\" crossorigin=\"anonymous\">"].join("")+[a.CSS_URL+"/select2.min.css",a.CSS_URL+"/daterangepicker.min.css",a.CSS_URL+"/forms/styles.min.css?"+1e5*Math.random()].map(function(h){return`<link rel="stylesheet" href="${h}">`}).join("")+`<style>${a.utils.screen(f.mainIframeCss)}</style>`}(),iframeScripts:function(){return f.parent_iframe_id="search-forms",[a.JS_URL+"/jquery-3.2.1.min.js",a.JS_URL+"/bootstrap.min.js",a.JS_URL+"/bundles/forms.js"].map(function(h){return`<script type="text/javascript" src="${h}"></script>`}).join("")+`<script>Travelsoft.forms.init(${JSON.stringify(f)})</script>`}()});return document.getElementById("search-forms-iframe-block").replaceChild(g,document.getElementById("search-forms-iframe-block").querySelector("span")),g},select:function(f){return f.plugin_name="select",b(f)},children:function(f){return f.plugin_name="children",b(f)},datepicker:function(f){var g,h;return f.plugin_name="datepicker",h=c(f),delete h.styles.width,h.styles["min-width"]=f.width+"px",h.styles["max-width"]="582px",h.iframeStylesheets+=`<link rel="stylesheet" href="${a.CSS_URL+"/daterangepicker.min.css"}">`+h.iframeStylesheets,h.iframeScripts=function(j){return[a.JS_URL+`/jquery-3.2.1.min.js`,a.JS_URL+`/moment.min.js`,a.JS_URL+`/moment_locales.min.js`,a.JS_URL+`/daterangepicker.min.js`,a.JS_URL+`/bundles/${j.plugin_name}.js`].map(function(k){return`<script type="text/javascript" src="${k}"></script>`}).join("")+`<script>Travelsoft.${j.plugin_name}.init(${JSON.stringify({iframe_id:j.iframe_id,start_date:j.data.start_date,end_date:j.data.end_date,format:j.data.format,date_separator:j.data.date_separator,defValue:j.data.defValue})})</script>`}(f),g=d(h),window.parent.document.body.appendChild(g),g}},searchResult:function(f){var g=f;g.page=1;var h=d({styles:{width:"100%",border:"none","z-index":10},attributes:{src:"about:blank",id:"search-result",scrolling:"no"},iframeContent:``,iframeStylesheets:function(){return["<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\" integrity=\"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u\" crossorigin=\"anonymous\">","<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css\" integrity=\"sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp\" crossorigin=\"anonymous\">"].join("")+[a.CSS_URL+"/owl.carousel.min.css",a.CSS_URL+"/search-result/styles.min.css"].map(function(j){return`<link rel="stylesheet" href="${j}">`}).join("")+`<style>${a.utils.screen(f.mainIframeCss)}</style>`}(),iframeScripts:function(){return["https://api-maps.yandex.ru/2.1/?lang=ru_RU",a.JS_URL+"/jquery-3.2.1.min.js",a.JS_URL+"/bootstrap.min.js",a.JS_URL+"/owl.carousel.min.js",a.JS_URL+"/pagenavigator.min.js",a.JS_URL+"/bundles/search_result.js"].map(function(j){return`<script type="text/javascript" src="${j}"></script>`}).join("")+`<script>Travelsoft.searchResult.init(${JSON.stringify(g)})</script>`}()});return document.getElementById("search-result-iframe-block").replaceChild(h,document.getElementById("search-result-iframe-block").querySelector("span")),h}}}})(Travelsoft);(function(a,b){"use strict";function c(){for(var r=parent.document.querySelectorAll(".iframe-plugin"),t=document.querySelectorAll(".span-plugin"),u=0;u<r.length;u++)r[u].style.display="none";for(var u=0;u<t.length;u++)t[u].innerHTML=f(t[u].innerHTML)}function d(){return`<span class="iframe-closer">&times;</span>`}function f(r){return r.replace(/<span class="iframe-closer">(.*)<\/span>/,"")}function g(r,t){var u=b(r.attr("href"));m(u,t.selectIframeCss),p(u,t.datepickerIframeCss),o(u,t.childrenIframeCss),u.find("form").find("button").each(function(){b(this).on("click",function(v){window.parent.open(b(this).data("url")+"?"+b(this).closest("form").serialize(),"__blank"),v.preventDefault()})})}function h(r,t,u,v,w,x){var y="iframe-plugin-"+r.id,z=k(r.id,v,y),A=a.frames.render.forms[w](l({iframe_id:y,self:r,data:t,scrolling:u,css:x}));return r.style.display="none",r.parentNode.insertBefore(z,r),{iframe:A,span:z}}function j(r,t,u,v){var w=function(y){for(var z=[],A=0;A<y.children.length;A++)z.push({selected:y.children[A].selected||!1,value:y.children[A].value,span_text:y.children[A].dataset.spanText,text:y.children[A].innerText});return z}(r),x=function(y){for(var z=0;z<y.children.length;z++)if(y.children[z].selected)return y.children[z].dataset.spanText;return y.children[0].dataset.spanText}(r);return h(r,w,u,x,t,v)}function k(r,t,u){var v=document.createElement("span");return v.id="span-for-"+r,v.className="form-control span-plugin",v.innerText=t,v.style.cursor="pointer",v.style.overflow="hidden",v.style.display="inline-block",v.style["line-height"]="22px",u&&(v.dataset.iframeLink=u),v}function l(r){return{iframe_id:r.iframe_id,top:b(r.self).offset().top+b(parent.document.getElementById("search-forms")).offset().top+31,left:b(r.self).offset().left+b(parent.document.getElementById("search-forms")).offset().left,width:b(r.self).outerWidth(),without:"yes"===r.self.dataset.without,height:r.self.dataset.iframeSelectHeight?r.self.dataset.iframeSelectHeight:500,data:r.data,select_id:r.self.id,scrolling:r.self.scrolling?"yes":"no",css:r.css}}function m(r,t){var u=[];return r.find("select[data-need-create-iframe-select=yes]").each(function(){var w,v=this,x=j(v,"select",!0,t);setInterval(function(){x.iframe.dataset.value&&x.iframe.dataset.value!==w&&(v.value=x.iframe.dataset.value,x.span.innerHTML=x.iframe.dataset.text,w=v.value,v.dispatchEvent(new Event("change")))},200),u.push(x)}),u}function n(r,t){var u=``;if(t.length)for(var v=0;v<t.length;v++)u+=`<input type="hidden" name="tpm_params[children_age][]" value="${t[v]}">`;r.innerHTML=u}function o(r,t){var u=[];return r.find("select[data-need-create-iframe-children=yes]").each(function(){var v=this,w=j(v,"children",!1,t),x=document.createElement("span"),y="",z="";x.dataset.def_age=v.dataset.def_age,w.span.parentNode.insertBefore(x,w.span),v.dataset.def_age.length&&n(x,function(A){for(var B=[],C=0;C<A.length;C++)B.push(A[C]);return B}(v.dataset.def_age.split(";"))),w.iframe.dataset.children="",w.iframe.dataset.age="",setInterval(function(A,B){B.iframe.dataset.children!==y&&(y=B.iframe.dataset.children,B.span.innerHTML=B.iframe.dataset.children+d(),A.value=y,A.dispatchEvent(new Event("change"))),B.iframe.dataset.age!==z&&(z=B.iframe.dataset.age,n(x,""===B.iframe.dataset.age?[]:B.iframe.dataset.age.split(";")))},200,v,w),u.push(w)}),u}function p(r,t){var u=[];r.find("input[data-need-create-iframe-datepicker=yes]").each(function(){var v=this,w=h(v,{start_date:b(v).data("start-date")||null,end_date:b(v).data("end-date")||null,format:b(v).data("format"),date_separator:b(v).data("date-separator"),defValue:v.value||null},!1,v.value||null,"datepicker",t),x;w.iframe.dataset.daterange=v.value,setInterval(function(){w.iframe.dataset.daterange!==x&&(x=w.iframe.dataset.daterange,w.span.innerHTML=w.iframe.dataset.daterange,v.value=w.iframe.dataset.daterange)},200),u.push(w)})}function q(r){var t=a.utils.screen;document.body.innerHTML+=`<div class="container" id="container">
                                            <div class="row">
                                                
                                                <ul class="nav nav-tabs">
                                                    ${function(u){var v="";for(var w in u)u.hasOwnProperty(w)&&(v+=`<li ${u[w].tabIsActive?"class=\"active\"":""}><a data-toggle="tab" href="#${t(w)}-form-area">${t(u[w].tabTitle)}</a></li>`);return v}(r)}
                                                </ul>
                                                <div class="tab-content clearfix">
                                                    ${function(){var v,u="";for(var w in r)r.hasOwnProperty(w)&&(v=t(w),u+=`<div class="tab-pane ${r[w].tabIsActive?"active":""}" id="${v}-form-area">
                                                                                    <form id="${w}-form">
                                                                                        <div class="col-md-3 col-sm-6">
                                                                                            <div class="form-group">
                                                                                                <label>
                                                                                                    ${t(r[w].objects.title)}
                                                                                                </label>
                                                                                                <select data-need-create-iframe-select="yes" name="tpm_params[id][]" id="${v}-objects" class="form-control objects">
                                                                                                    ${function(x){for(var y="",z=0;z<x.length;z++)y+=`<option data-span-text="${t(x[z].source_name)}" ${x[z].isSelected?"selected=\"\"":""} value="${t(x[z].id)}">${t(x[z].name)}</option>`;return y}(r[w].objects.forSelect)}
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3 col-sm-6">
                                                                    <div class="form-group">
                                                                        <label>
                                                                            ${t(r[w].dates.title)}
                                                                        </label>
                                                                        <input data-need-create-iframe-datepicker="yes"  data-format="${t(r[w].dates.format)}" data-date-separator="${t(r[w].dates.separator)}" data-duration-title="${t(r[w].dates.durationTitle)}" value="${t(r[w].dates.defValue)}" name="tpm_params[date_range]" id="${v}-datepicker" type="text" class="datepicker form-control" >
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2 col-sm-6">
                                                                    <div class="form-group">
                                                                        <label>
                                                                            ${t(r[w].adults.title)}
                                                                        </label>
                                                                        <select data-without="yes" data-iframe-select-height="200" data-need-create-iframe-select="yes" id="${v}-adults-select" name="tpm_params[adults]" class="form-control select2">
                                                                            <option data-span-text="1" ${1===+r[w].adults.defValue?`selected=""`:``} value="1">1</option>
                                                                            <option data-span-text="2" ${2===+r[w].adults.defValue?`selected=""`:``} value="2">2</option>
                                                                            <option data-span-text="3" ${3===+r[w].adults.defValue?`selected=""`:``} value="3">3</option>
                                                                            <option data-span-text="4" ${4===+r[w].adults.defValue?`selected=""`:``} value="4">4</option>
                                                                            <option data-span-text="5" ${5===+r[w].adults.defValue?`selected=""`:``} value="5">5</option>
                                                                            <option data-span-text="6" ${6===+r[w].adults.defValue?`selected=""`:``} value="6">6</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2 col-sm-6">
                                                                    <div class="form-group">
                                                                        <label>
                                                                            ${t(r[w].children.title)}
                                                                        </label>
                                                                        <select data-def_age='${r[w].children_age.defValue.join(";")}' data-iframe-select-height="100" data-need-create-iframe-children="yes" name="tpm_params[children]" class="form-control" id="${v}-children">
                                                                            <option data-span-text="0" ${0===r[w].children.defValue?`selected=""`:``} value="0">0</option>
                                                                            <option data-span-text="1" ${1===r[w].children.defValue?`selected=""`:``} value="1">1</option>
                                                                            <option data-span-text="2" ${2===r[w].children.defValue?`selected=""`:``} value="2">2</option>
                                                                            <option data-span-text="3" ${3===r[w].children.defValue?`selected=""`:``} value="3">3</option>
                                                                            <option data-span-text="4" ${4===r[w].children.defValue?`selected=""`:``} value="4">4</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2 col-sm-12">
                                                                    <div class="form-group btn-search-area">
                                                                        <button data-url="${t(r[w].url)}" data-onclick-handler-name="search" type="button" class="btn btn-primary">${t(r[w].button.title)}</button>
                                                                    </div>
                                                                </div>
                                                            </form>
                                                        </div>`);return u}()}
                                                </div>
                                            </div>
                                        </div>`,a.utils.HWatcher.__parent=window.parent.document.getElementById("search-forms"),a.utils.HWatcher.watch(document.body)}a.forms={init:function(r){var t=a.utils;t.sendRequest("GetFormsRenderData",["tpm_params[types]="+r.types.join("|"),"tpm_params[active]="+r.active,function(){return window.parent.location.search.replace("?","").split("&").filter(function(u){return 0<u.length&&0===u.indexOf("tpm_params")}).join("&")}()],function(u){return function(v){return v.isError?void console.warn(v.errorMessage):void(q(function(w,x){for(var y=w,z=0;z<x.types.length;z++)y[x.types[z]].url=x.url[z];return y}(v.data,u)),setTimeout(function(){b(".nav-tabs a").each(function(){var w=b(this);w.parent().hasClass("active")?g(w,u):w.one("shown.bs.tab",function(){g(w,u)})}),parent.document.addEventListener("click",function(){c()}),document.addEventListener("click",function(w){var x,y;return"SPAN"===w.target.nodeName&&-1<w.target.className.indexOf("span-plugin")&&w.target.dataset.iframeLink?(x=parent.document.getElementById(w.target.dataset.iframeLink),y="block"===x.style.display,c(),void(y||(x.style.display="block",w.target.innerHTML=w.target.innerText+d()))):void c()})},100))}}(r))}}})(Travelsoft,jQuery);
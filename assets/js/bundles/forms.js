var Travelsoft=Travelsoft||{};(function(a){"use strict";a.SITE_ADDRESS="https://vetliva.ru",a.VIDEO_URL="https://www.youtube.com/embed/",a.REQUEST_URL=a.SITE_ADDRESS+"/travelsoft.pm",a.JS_URL=a.REQUEST_URL+"/assets/js",a.CSS_URL=a.REQUEST_URL+"/assets/css"})(Travelsoft);(function(a){"use strict";a.utils={callbacks:{},makeid:function(){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;5>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b},sendRequest:function(b,c,d){function f(){g||(delete a.utils.callbacks[h],console.warn("Query error "+j))}var g=!1,h="cb"+(Math.random()+"").slice(-6),j=a.REQUEST_URL+"/?",k=c,l;k.push("callback=Travelsoft.utils.callbacks."+h),k.push("method="+b),j+=k.join("&"),a.utils.callbacks[h]=function(m){g=!0,delete a.utils.callbacks[h],d(m)},l=document.createElement("script"),l.type="text/javascript",l.onload=f,l.onerror=f,l.src=j,document.body.appendChild(l)},screen:function(b){var c="";return"string"==typeof b&&(c=b.replace(/&/g,"&amp;"),c=b.replace(/</g,"&lt;"),c=b.replace(/"/g,"&quot;"),c=b.replace(/>/g,"&gt;"),c=b.replace(/'/g,"&#039;"),c=b.replace(/script/g,""),c=b.replace(/onclick/g,""),c=b.replace(/onchange/g,""),c=b.replace(/onkeydown/g,""),c=b.replace(/onkeypress/g,""),c=b.replace(/onmouseout/g,""),c=b.replace(/onmouseover/g,"")),c},HWatcher:{__prev:null,__id:null,__parent:null,watch:function(b){var c=this;c.unwatch(b),c.__id=setInterval(function(){c.__prev!==b.scrollHeight&&(c.__parent&&(c.__parent.style.height=b.scrollHeight+10+"px"),c.__prev=b.scrollHeight)},100)},unwatch:function(b){this.__id&&(clearInterval(this.__id),this.__id=null,this.__prev=null,b.style.height=0)}}}})(Travelsoft);(function(a){"use strict";function b(f){var g=d(c(f));return window.parent.document.body.appendChild(g),g}function c(f){return{styles:{position:"absolute",display:"none",top:f.top+6+"px",left:f.left+"px",width:f.width+"px",height:f.height+"px",border:"1px solid #ccc","box-sizing":"border-box","z-index":10,"padding-right":"1px"},attributes:{src:"about:blank",id:f.iframe_id,scrolling:f.scrolling?"yes":"no",className:"iframe-plugin"},iframeContent:``,iframeStylesheets:function(){return["<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\" integrity=\"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u\" crossorigin=\"anonymous\">","<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css\" integrity=\"sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp\" crossorigin=\"anonymous\">"].join("")+[a.CSS_URL+`/forms/${f.plugin_name}.min.css?`+1e5*Math.random()].map(function(g){return`<link rel="stylesheet" href="${g}">`}).join("")+`<style>${a.utils.screen(f.css)}</style>`}(),iframeScripts:function(){return[a.JS_URL+`/bundles/${f.plugin_name}.js`].map(function(g){return`<script type="text/javascript" src="${g}"></script>`}).join("")+`<script>Travelsoft.${f.plugin_name}.init(${JSON.stringify({iframe_id:f.iframe_id,data:f.data,without:f.without})})</script>`}()}}function d(f){var g=document.createElement("iframe");for(var h in f.styles)g.style[h]=f.styles[h];for(var j in f.attributes)g[j]=f.attributes[j];return g.onload=function(){g.contentDocument.write(a.frames.template.replace("{{stylesheets}}",f.iframeStylesheets).replace("{{content}}",f.iframeContent).replace("{{scripts}}",f.iframeScripts))},g}a.frames={template:`<!DOCTYPE html>
                        <html>
                            <head>
                                <title>travelsoft partner module</title>
                                <meta charset="UTF-8">
                                {{stylesheets}}
                            </head>
                            <body>
                                {{content}}
                                {{scripts}}
                            </body>
                        </html>`,render:{forms:{form:function(f){var g="search-forms-"+Math.ceil(1e3*Math.random()),h=d({styles:{width:"100%",border:"none"},attributes:{src:"about:blank",id:g,scrolling:"yes"},iframeContent:``,iframeStylesheets:function(){return["<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\" integrity=\"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u\" crossorigin=\"anonymous\">","<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css\" integrity=\"sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp\" crossorigin=\"anonymous\">"].join("")+[a.CSS_URL+"/select2.min.css",a.CSS_URL+"/daterangepicker.min.css",a.CSS_URL+"/forms/styles.min.css?"+1e5*Math.random()].map(function(j){return`<link rel="stylesheet" href="${j}">`}).join("")+`<style>${a.utils.screen(f.mainIframeCss)}</style>`}(),iframeScripts:function(){return f.parent_iframe_id=g,[a.JS_URL+"/jquery-3.2.1.min.js",a.JS_URL+"/bootstrap.min.js",a.JS_URL+"/bundles/forms.js"].map(function(j){return`<script type="text/javascript" src="${j}"></script>`}).join("")+`<script>Travelsoft.forms.init(${JSON.stringify(f)})</script>`}()});return document.getElementById(f.insertion_id).replaceChild(h,document.getElementById(f.insertion_id).querySelector("span")),h},select:function(f){return f.plugin_name="select",b(f)},children:function(f){return f.plugin_name="children",b(f)},datepicker:function(f){var g,h,j=f.left-303+f.width;return f.plugin_name="datepicker",h=c(f),h.styles.width="303px",h.styles.left=j+"px",h.iframeStylesheets+=`<link rel="stylesheet" href="${a.CSS_URL+"/daterangepicker.min.css"}">`+h.iframeStylesheets,h.iframeScripts=function(k){return[a.JS_URL+`/jquery-3.2.1.min.js`,a.JS_URL+`/moment.min.js`,a.JS_URL+`/moment_locales.min.js`,a.JS_URL+`/daterangepicker.min.js`,a.JS_URL+`/bundles/${k.plugin_name}.js`].map(function(l){return`<script type="text/javascript" src="${l}"></script>`}).join("")+`<script>Travelsoft.${k.plugin_name}.init(${JSON.stringify({iframe_id:k.iframe_id,start_date:k.data.start_date,end_date:k.data.end_date,format:k.data.format,date_separator:k.data.date_separator,defValue:k.data.defValue})})</script>`}(f),g=d(h),window.parent.document.body.appendChild(g),g}},searchResult:function(f){var g=f;g.page=1;var h=d({styles:{width:"100%",border:"none","z-index":10},attributes:{src:"about:blank",id:"search-result_"+f.insertion_id,scrolling:"no"},iframeContent:``,iframeStylesheets:function(){return["<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\" integrity=\"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u\" crossorigin=\"anonymous\">","<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css\" integrity=\"sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp\" crossorigin=\"anonymous\">"].join("")+[a.CSS_URL+"/owl.carousel.min.css",a.CSS_URL+"/search-result/styles.min.css"].map(function(j){return`<link rel="stylesheet" href="${j}">`}).join("")+`<style>${a.utils.screen(f.mainIframeCss)}</style>`}(),iframeScripts:function(){return["https://api-maps.yandex.ru/2.1/?lang=ru_RU",a.JS_URL+"/jquery-3.2.1.min.js",a.JS_URL+"/bootstrap.min.js",a.JS_URL+"/owl.carousel.min.js",a.JS_URL+"/pagenavigator.min.js",a.JS_URL+"/bundles/search_result.js"].map(function(j){return`<script type="text/javascript" src="${j}"></script>`}).join("")+`<script>Travelsoft.searchResult.init(${JSON.stringify(g)})</script>`}()});return document.getElementById(f.insertion_id).replaceChild(h,document.getElementById(f.insertion_id).querySelector("span")),h}}}})(Travelsoft);(function(a,b){"use strict";function c(){for(var r=parent.document.querySelectorAll(".iframe-plugin"),t=document.querySelectorAll(".span-plugin"),u=0;u<r.length;u++)r[u].style.display="none";for(var u=0;u<t.length;u++)t[u].innerHTML=f(t[u].innerHTML)}function d(){return`<span class="iframe-closer">&times;</span>`}function f(r){return r.replace(/<span class="iframe-closer">(.*)<\/span>/,"")}function g(r,t){var u=b(r.attr("href"));m(u,t.selectIframeCss,t.parent_iframe_id),p(u,t.datepickerIframeCss,t.parent_iframe_id),o(u,t.childrenIframeCss,t.parent_iframe_id),u.find("form").find("button").each(function(){b(this).on("click",function(v){window.parent.open(b(this).data("url")+"?"+b(this).closest("form").serialize(),"__blank"),v.preventDefault()})})}function h(r,t,u,v,w,x,y){var z="iframe-plugin-"+r.id,A=k(r.id,v,z),B=a.frames.render.forms[w](l({iframe_id:z,self:r,data:t,scrolling:u,css:x,parentIframeId:y}));return r.style.display="none",r.parentNode.insertBefore(A,r),{iframe:B,span:A}}function j(r,t,u,v,w){var x=function(z){for(var A=[],B=0;B<z.children.length;B++)A.push({selected:z.children[B].selected||!1,value:z.children[B].value,span_text:z.children[B].dataset.spanText,text:z.children[B].innerText});return A}(r),y=function(z){for(var A=0;A<z.children.length;A++)if(z.children[A].selected)return z.children[A].dataset.spanText;return z.children[0].dataset.spanText}(r);return h(r,x,u,y,t,v,w)}function k(r,t,u){var v=document.createElement("span");return v.id="span-for-"+r,v.className="form-control span-plugin",v.innerText=t,v.style.cursor="pointer",v.style.overflow="hidden",v.style["white-space"]="nowrap",v.style["text-overflow"]="ellipsis",v.style.display="inline-block",v.style["padding-right"]="22px",v.style["line-height"]="22px",u&&(v.dataset.iframeLink=u),v}function l(r){return{iframe_id:r.iframe_id,top:b(r.self).offset().top+b(parent.document.getElementById(r.parentIframeId)).offset().top+31,left:b(r.self).offset().left+b(parent.document.getElementById(r.parentIframeId)).offset().left,width:b(r.self).outerWidth(),without:"yes"===r.self.dataset.without,height:r.self.dataset.iframeSelectHeight?r.self.dataset.iframeSelectHeight:500,data:r.data,select_id:r.self.id,scrolling:r.self.scrolling?"yes":"no",css:r.css}}function m(r,t,u){var v=[];return r.find("select[data-need-create-iframe-select=yes]").each(function(){var x,w=this,y=j(w,"select",!0,t,u);setInterval(function(){y.iframe.dataset.value&&y.iframe.dataset.value!==x&&(w.value=y.iframe.dataset.value,y.span.innerHTML=y.iframe.dataset.text,x=w.value,w.dispatchEvent(new Event("change")))},200),v.push(y)}),v}function n(r,t){var u=``;if(t.length)for(var v=0;v<t.length;v++)u+=`<input type="hidden" name="tpm_params[children_age][]" value="${t[v]}">`;r.innerHTML=u}function o(r,t,u){var v=[];return r.find("select[data-need-create-iframe-children=yes]").each(function(){var w=this,x=j(w,"children",!1,t,u),y=document.createElement("span"),z="",A="";y.dataset.def_age=w.dataset.def_age,x.span.parentNode.insertBefore(y,x.span),w.dataset.def_age.length&&n(y,function(B){for(var C=[],D=0;D<B.length;D++)C.push(B[D]);return C}(w.dataset.def_age.split(";"))),x.iframe.dataset.children="",x.iframe.dataset.age="",setInterval(function(B,C){C.iframe.dataset.children!==z&&(z=C.iframe.dataset.children,C.span.innerHTML=C.iframe.dataset.children+d(),B.value=z,B.dispatchEvent(new Event("change"))),C.iframe.dataset.age!==A&&(A=C.iframe.dataset.age,n(y,""===C.iframe.dataset.age?[]:C.iframe.dataset.age.split(";")))},200,w,x),v.push(x)}),v}function p(r,t,u){var v=[];r.find("input[data-need-create-iframe-datepicker=yes]").each(function(){var w=this,x=h(w,{start_date:b(w).data("start-date")||null,end_date:b(w).data("end-date")||null,format:b(w).data("format"),date_separator:b(w).data("date-separator"),defValue:w.value||null},!1,w.value||null,"datepicker",t,u),y;x.iframe.dataset.daterange=w.value,setInterval(function(){x.iframe.dataset.daterange!==y&&(y=x.iframe.dataset.daterange,x.span.innerHTML=x.iframe.dataset.daterange,w.value=x.iframe.dataset.daterange)},200),v.push(x)})}function q(r){var t=a.utils.screen;document.body.innerHTML+=`<div class="container" id="container">
                                            <div class="row">
                                                
                                                <ul class="nav nav-tabs">
                                                    ${function(u){var v="";for(var w in u)u.hasOwnProperty(w)&&(v+=`<li ${u[w].tabIsActive?"class=\"active\"":""}><a data-toggle="tab" href="#${t(w)}-form-area">${t(u[w].tabTitle)}</a></li>`);return v}(r)}
                                                </ul>
                                                <div class="tab-content clearfix">
                                                    ${function(){var v,u="";for(var w in r)r.hasOwnProperty(w)&&(v=t(w),u+=`<div class="tab-pane ${r[w].tabIsActive?"active":""}" id="${v}-form-area">
                                                                                    <form id="${w}-form">
                                                                                        <div class="col-md-3 col-sm-6 col-xs-6">
                                                                                            <div class="form-group">
                                                                                                <label>
                                                                                                    ${t(r[w].objects.title)}
                                                                                                </label>
                                                                                                <select data-need-create-iframe-select="yes" name="tpm_params[id][]" id="${v}-objects" class="form-control objects">
                                                                                                    ${function(x){for(var y="",z=0;z<x.length;z++)y+=`<option data-span-text="${t(x[z].source_name)}" ${x[z].isSelected?"selected=\"\"":""} value="${t(x[z].id)}">${t(x[z].name)}</option>`;return y}(r[w].objects.forSelect)}
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3 col-sm-6 col-xs-6">
                                                                    <div class="form-group">
                                                                        <label>
                                                                            ${t(r[w].dates.title)}
                                                                        </label>
                                                                        <input data-need-create-iframe-datepicker="yes"  data-format="${t(r[w].dates.format)}" data-date-separator="${t(r[w].dates.separator)}" data-duration-title="${t(r[w].dates.durationTitle)}" value="${t(r[w].dates.defValue)}" name="tpm_params[date_range]" id="${v}-datepicker" type="text" class="datepicker form-control" >
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2 col-sm-6 col-xs-6">
                                                                    <div class="form-group">
                                                                        <label>
                                                                            ${t(r[w].adults.title)}
                                                                        </label>
                                                                        <select ${""} id="${v}-adults-select" name="tpm_params[adults]" class="form-control select2">
                                                                            <option data-span-text="1" ${1===+r[w].adults.defValue?`selected=""`:``} value="1">1</option>
                                                                            <option data-span-text="2" ${2===+r[w].adults.defValue?`selected=""`:``} value="2">2</option>
                                                                            <option data-span-text="3" ${3===+r[w].adults.defValue?`selected=""`:``} value="3">3</option>
                                                                            <option data-span-text="4" ${4===+r[w].adults.defValue?`selected=""`:``} value="4">4</option>
                                                                            <option data-span-text="5" ${5===+r[w].adults.defValue?`selected=""`:``} value="5">5</option>
                                                                            <option data-span-text="6" ${6===+r[w].adults.defValue?`selected=""`:``} value="6">6</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2 col-sm-6 col-xs-6">
                                                                    <div class="form-group">
                                                                        <label>
                                                                            ${t(r[w].children.title)}
                                                                        </label>
                                                                        <select data-def_age='${r[w].children_age.defValue.join(";")}' data-iframe-select-height="100" data-need-create-iframe-children="yes" name="tpm_params[children]" class="form-control" id="${v}-children">
                                                                            <option data-span-text="0" ${0===r[w].children.defValue?`selected=""`:``} value="0">0</option>
                                                                            <option data-span-text="1" ${1===r[w].children.defValue?`selected=""`:``} value="1">1</option>
                                                                            <option data-span-text="2" ${2===r[w].children.defValue?`selected=""`:``} value="2">2</option>
                                                                            <option data-span-text="3" ${3===r[w].children.defValue?`selected=""`:``} value="3">3</option>
                                                                            <option data-span-text="4" ${4===r[w].children.defValue?`selected=""`:``} value="4">4</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2 col-sm-6 col-xs-6">
                                                                    <div class="form-group btn-search-area">
                                                                        <button data-url="${t(r[w].url)}" data-onclick-handler-name="search" type="button" class="btn btn-primary">${t(r[w].button.title)}</button>
                                                                    </div>
                                                                </div>
                                                            </form>
                                                        </div>`);return u}()}
                                                </div>
                                            </div>
                                        </div>`}a.forms={init:function(r){var t=a.utils;t.sendRequest("GetFormsRenderData",["tpm_params[types]="+r.types.join("|"),"tpm_params[active]="+r.active,function(u){var v="";return b.isArray(u.def_objects)&&(v+="tpm_params[def_objects]="+u.def_objects.join("|")),v+=window.parent.location.search.replace("?","").split("&").filter(function(w){return 0<w.length&&0===w.indexOf("tpm_params")}).join("&"),v}(r)],function(u){return function(v){return v.isError?void console.warn(v.errorMessage):void(q(function(w,x){for(var y=w,z=0;z<x.types.length;z++)y[x.types[z]].url=x.url[z];return y}(v.data,u)),a.utils.HWatcher.__parent=window.parent.document.getElementById(u.parent_iframe_id),a.utils.HWatcher.watch(document.body),setTimeout(function(){b(".nav-tabs a").each(function(){var w=b(this);w.parent().hasClass("active")?g(w,u):w.one("shown.bs.tab",function(){g(w,u)})}),parent.document.addEventListener("click",function(){c()}),document.addEventListener("click",function(w){var x,y;return"SPAN"===w.target.nodeName&&-1<w.target.className.indexOf("span-plugin")&&w.target.dataset.iframeLink?(x=parent.document.getElementById(w.target.dataset.iframeLink),y="block"===x.style.display,c(),void(y||(x.style.display="block",w.target.innerHTML=w.target.innerText+d()))):void c()})},100))}}(r))}}})(Travelsoft,jQuery);